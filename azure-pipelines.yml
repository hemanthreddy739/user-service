trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

steps:
- script: |
    python3 -m venv venv
    source venv/bin/activate
    pip install --upgrade pip
    pip install -r requirements.txt
    pip install pytest pytest-cov
  displayName: 'Create venv & install dependencies'

- script: |
    source venv/bin/activate
    pytest --cov=./ --cov-report=xml:coverage.xml
  displayName: 'Run tests and collect coverage'

- task: PublishCodeCoverageResults@2
  inputs:
    summaryFileLocation: 'coverage.xml'
  displayName: 'Publish code coverage'
